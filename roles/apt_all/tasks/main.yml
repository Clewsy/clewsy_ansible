---
- name: Ensure bin directory exists within user's home directory.
  file:
    dest: "/home/{{ ansible_user }}/bin"
    mode: 0755
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    state: directory

- name: Copy apt_all.sh script to user's bin directory.
  get_url:
    url: "{{ apt_all_script_url }}"
    dest: "/home/{{ ansible_user }}/bin/apt_all.sh"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0755

- name: Copy default lisy of hosts to /home/{{ ansible_user }}/bin/my_hosts.list.
  copy:
    src: "files/my_hosts.list"
    dest: "/home/{{ ansible_user }}/bin/my_hosts.list"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0644

- name: Create cron-job to periodically update and upgrade packages for all hosts in my_hosts.list (i.e. run apt_all.sh).
  cron:
    name: Run update/upgrade script (~/bin/apt_all.sh).
    user: "{{ ansible_user }}"
    minute: "47"
    hour: "1"
    job: "/home/{{ ansible_user }}/bin/apt_all.sh"
  notify: Restart cron.
