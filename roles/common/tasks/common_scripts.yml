---
- name: '[common_scripts] Load common_scripts variables.'
  include_vars: common_scripts_vars.yml

- name: '[common_scripts] Ensure bin directory exists within user home directory.'
  file:
    dest: "/home/{{ ansible_user }}/bin"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'

###bu.sh

- name: '[common_scripts] Copy bu.sh script to user bin directory.'
  get_url:
    url: "{{ bu_script_url }}"
    dest: "/home/{{ ansible_user }}/bin/bu.sh"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'

- name: '[common_scripts] Determine if a host-specific backup file list exists (bu.list_{{ ansible_hostname }}).'
  local_action: stat path="{{ bu_list_files_dir }}/bu.list_{{ ansible_hostname }}"
  register: host_specific_bu_list

- name: "[common_scripts] Copy host-specific backup list (bu.list) to /home/{{ ansible_user }}/bin."
  copy:
    src: "{{ bu_list_files_dir }}/bu.list_{{ ansible_hostname }}"
    dest: "/home/{{ ansible_user }}/bin/bu.list"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0644'
  when: host_specific_bu_list.stat.exists
  register: bu_list_copy

- name: "[common_scripts] Copy generic backup list (bu.list) as host-specific list does not exist."
  copy:
    content: |
      ~/.ssh
    dest: "/home/{{ ansible_user }}/bin/bu.list"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0644'
  when: bu_list_copy is skipped

###stuff.sh

- name: '[common_scripts] Copy stuff.sh script to user bin directory.'
  get_url:
    url: "{{ stuff_script_url }}"
    dest: "/home/{{ ansible_user }}/bin/stuff.sh"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'

- name: "[common_scripts] Customize stuff.sh colour theme - desired colour for {{ ansible_hostname }} is {{ theme_colour }}."
  lineinfile:
    path: "/home/{{ ansible_user }}/bin/stuff.sh"
    regexp: '^COL='
    line: "COL=\"${{ '{' }}{{ theme_colour }}{{ '}' }}\"" #Use jinja expression to "escape" braces.

###wami.sh

- name: '[common_scripts] Copy wami.sh script to user bin directory.'
  get_url:
    url: "{{ wami_script_url }}"
    dest: "/home/{{ ansible_user }}/bin/wami.sh"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '0755'





