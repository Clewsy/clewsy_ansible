---
- name: 'Set hostname ({{ ansible_hostname }}) to {{ host_name }}.'
  hostname:
    name: "{{ host_name }}"
    use: systemd

- name: Set local timezone to {{ local_tz }}.
  timezone:
    name: "{{ local_tz }}"

- name: Add keys and configure ssh.
  include: ssh.yml

- name: Enable passwordless sudo.
  copy:
    content: |
      #Added by ansible.  Enable passwordless sudo for members of group sudo.
      %sudo ALL=(ALL) NOPASSWD: ALL
    dest: /etc/sudoers.d/enable-passwordless-sudo
    owner: 'root'
    group: 'root'
    mode: '0440'

- name: Update apt cache and run a full upgrade.
  apt:
    upgrade: 'full'
    update_cache: yes
    autoremove: yes
    autoclean: yes
    cache_valid_time: 86400 #Cache is valid for 24 hours.

- name: Install common packages.
  apt:
    name: "{{ common_packages }}"
    state: latest
    
- name: Install and configure vim.
  include: vim.yml

- name: Install and configure git.
  include: git.yml

- name: Install and configure lm-sensors.
  include: lm-sensors.yml

- name: Install host-specific miscellaneous packages.
  include: misc_packages.yml

- name: Set custom motd.
  include: motd.yml

- name: Configure .bashrc file.
  include: bashrc.yml

- name: Configure aliases.
  include: aliases.yml

- name: Configure cron jobs.
  cron:
    name: "{{ item.name }}"
    minute: "{{ item.minute }}"
    hour: "{{ item.hour }}"
    weekday: "{{ item.weekday }}"
    day: "{{ item.day }}"
    month: "{{ item.month }}"
    user: "{{ ansible_user }}"
    job: "{{ item.job }}"
  with_items: "{{ cron_jobs }}"
  when: cron_jobs.0 is defined
  notify: Restart cron.

- name: Configure mounts.
  include: mounts.yml

- name: "Add custom paths to PATH variable for {{ ansible_user }}."
  lineinfile:
    path: "{{ ansible_user_home_dir }}/.profile"
    state: present
    line: "export PATH=$PATH:{{ item }}"
    insertafter: EOF
  with_items: "{{ path_additions }}"
  when: path_additions.0 is defined

- name: Install and configure common scripts.
  include: common_scripts.yml
