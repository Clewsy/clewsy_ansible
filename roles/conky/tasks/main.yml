---
- name: Install conky.
  apt:
    name: conky
    state: latest
    update_cache: yes

- name: Copy conky configuration file.
  get_url:
    url: "{{ conky_config_url }}"
    dest: "/home/{{ ansible_user }}/.conkyrc"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0640

- name: Ensure autostart directory exists.
  file:
    dest: "/home/{{ ansible_user }}/.config/autostart"
    mode: 0755
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    state: directory

- name: Create autostart entry.
  copy:
    content: |
      [Desktop Entry]
      Type=Application
      Exec=conky -dq 
      Hidden=false
      NoDisplay=false
      X-GNOME-Autostart-enabled=true
      Name[en_AU]=Conky
      Name=Conky
      Comment=Conky start-up config generated by ansible.
    dest: "/home/{{ ansible_user }}/.config/autostart/conky.desktop"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0664

