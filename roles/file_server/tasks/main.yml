---
- stat: #Check for the existence of disks by label as defined in host specific variables (nuf_server_disks).
    path: "/dev/disk/by-label/{{ item.label }}"
  loop: "{{ file_server_disks }}"
  register: labels_stat

- name: Label the partitions (with e2label) if label not already applied to disk uuid (var file_server_disks). 
  shell: "/usr/sbin/e2label /dev/disk/by-uuid/{{ item.item.uuid }} {{ item.item.label }}"
  when: item.stat.exists == false
  loop: "{{ labels_stat.results }}"

- name: Mount the disks to /srv.
  mount:
    src: "LABEL={{ item.label }}"
    path: "/srv/{{ item.label }}"
    fstype: auto
    opts: 'defaults'
    state: mounted
  with_items: "{{ file_server_disks }}"

- name: Configure nfs shares.
  include: nfs.yml
  when: file_server_nfs_shares.0 is defined 

- name: Configure cifs shares.
  include: cifs.yml
  when: file_server_cifs_shares is defined