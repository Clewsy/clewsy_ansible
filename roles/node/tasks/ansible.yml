---
- name: '[ansible] Load ansible variables.'
  include_vars: ansible_vars.yml

- name: '[ansible] Ensure all packages required for using ansible are installed.'
  apt:
    name: "{{ ansible_packages }}"
    state: latest

- name: '[ansible] Clone repo to home directory.'
  git:
    repo: "{{ ansible_repo }}"
    dest: "/home/{{ ansible_user }}/ansible"
    accept_hostkey: yes
    key_file: "/home/{{ ansible_user }}/.ssh/id_rsa"
  register: ansible_clone
  ignore_errors: True

- name: '[ansible] Error notification.'
  debug: 
    msg: "Did not clone repo.  Already exists with changes."
  when: ansible_clone is failed

- name: '[ansible] Ensure cloned ansible repo is owned by {{ ansible_user }}'
  file:
    recurse: yes
    path: "/home/{{ ansible_user }}/ansible"
    state: directory
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
  when: ansible_clone is changed
