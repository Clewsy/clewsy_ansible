---
- name: Ensure bin directory exists within user's home directory.
  file:
    dest: "{{ ansible_user_home_dir }}/bin"
    mode: 0755
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    state: directory

- name: Copy polly.sh script for use by {{ ansible_user }}.
  get_url:
    url: "{{ polly_script_url }}"
    dest: "{{ polly_script_dest_user }}"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: 0755

- name: Copy polly.sh script for root use.
  copy:
    remote_src: yes
    src: "{{ polly_script_dest_user }}"
    dest: "{{ polly_script_dest_root }}"
    owner: "root"
    group: "root"
    mode: 0755

- name: Install and enable blink1-tool.
  include: blink1_tool.yml

- name: Create cronjob for polly.sh poll jobs.
  cron:
    name: "Role: \"polly\" - Run polly.sh."
    minute: "*/5"
    user: "{{ ansible_user }}"
    job: "sudo {{ polly_script_dest_root }}"
  notify: Restart cron.
