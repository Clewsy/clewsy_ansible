---
rsync_server_packages:
  - rsync

#rsync_server_logdir: "/var/log/rsync_server"
#rsync_server_logfile: "{{ rsync_server_logdir }}/rsync_server.log"
rsync_server_logdir: "/var/log"
rsync_server_logfile: "{{ rsync_server_logdir }}/rsync_server.log"

rsync_server_rsync_job: 'rsync --verbose --archive --delete --acls --human-readable --progress --log-file={{ rsync_server_logfile }} -e "ssh -o StrictHostKeyChecking=no" {{ item.source }} {{ item.dest }}'

rsync_server_backup_scripts_lib_dir: "/usr/local/lib/rsync_server"
rsync_server_backup_scripts_user_dir: "{{ ansible_user_home_dir }}/bin/rsync_server"

rsync_server_backup_script: |
  #!/bin/bash
  # Manual rsync backup script generated by ansible.
  # Check for sudo.
  if [[ "${EUID}" != 0 ]]; then printf "%b" "Must be run as root.  Quitting\n" && exit 1; fi

  printf "%b" "---------- Job Started : $(date +%Y-%m-%d\ %T) ----------\n" >> {{ rsync_server_logfile }}
  {{ rsync_server_rsync_job }}
  printf "%b" "---------- Job Completed : $(date +%Y-%m-%d\ %T) ----------\n" >> {{ rsync_server_logfile }}

rsync_server_logrotate_file: |
  {{ rsync_server_logfile }} {
  	su root root
  	weekly
  	rotate 12
  	compress
  	delaycompress
  	missingok
  	notifempty
  	create 644 root
  }
  