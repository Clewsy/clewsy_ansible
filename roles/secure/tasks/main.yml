---
- name: Disable ssh root login.
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^PermitRootLogin'
    line: 'PermitRootLogin no'
    state: present
    insertafter: '^#PermitRootLogin'
  notify: Restart ssh.

- name: Disable ssh password authentication.
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^PasswordAuthentication'
    line: 'PasswordAuthentication no'
    state: present
    insertafter: '^#PasswordAuthentication'
  notify: Restart ssh.

- name: Set ssh to protocol 2 only.
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^Protocol'
    line: 'Protocol 2'
    state: present
    insertafter: '^#Protocol'
  notify: Restart ssh.

- name: Set ssh client idle timeout.
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^ClientAliveInterval'
    line: 'ClientAliveInterval 300'
    state: present
    insertafter: '^#ClientAliveInterval'
  notify: Restart ssh.

- name: Disable ssh X11 forwarding..
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^X11Forwarding'
    line: 'X11Forwarding no'
    state: present
    insertafter: '^#X11Forwarding'
  notify: Restart ssh.

- name: Install and configure ufw.
  include: ufw.yml
