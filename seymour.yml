---
- name: Configure seymour.
  hosts: seymour
  become: yes
  gather_facts: True
  roles:
    - init_config
    - ssh
    - ssh_secure
    - sudo
    - vim
    - git
    - polly
    - pong
    - bu
    - ball
    - apt_all
    - stuff
    - wami
    - whodis
    - misc_packages
    - mounts

  # Run tasks specific only to seymour
  tasks:

    - name: Clone repos to home directory.
      git:
        repo: "{{ git_repo_root_ssh }}/{{ item }}"
        dest: "/home/{{ ansible_user }}/{{ item }}"
        accept_hostkey: yes
        key_file: "/home/{{ ansible_user }}/.ssh/id_rsa"
      with_items: "{{ repos }}"
      register: repo_clones
    
    - name: Ensure cloned repos are owned by {{ ansible_user }}{{ ':' }}{{ ansible_user }}
      file:
        recurse: yes
        path: "/home/{{ ansible_user }}/{{ item }}"
        state: directory
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
      with_items: "{{ repos }}"
      when: repo_clones is changed

    - name: Disable gnupg key cacheing.
      copy:
        content: |
          #Disable agent cache
          default-cache-ttl 0
          max-cache-ttl 0
        dest: "/home/{{ ansible_user }}/.gnupg/gpg-agent.conf"
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: 0644

  vars:
    repos:
      - scripts
      - misc
      - docs