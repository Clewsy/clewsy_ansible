## Must be able to log in as b4t with sudo access.
---
- name: Configure seymour.
  hosts: seymour
  become: yes
  roles:
    - init_config
    - ssh
    - ssh_secure
    - sudo
    - vim
    - git
#    - snap
#    - docker
#    - clews.pro
    - polly
    - pong
    - bu
    - ball
    - apt_all
    - stuff
#    - terbling
#    - vpn
    - wami
    - whodis
    - misc_packages
#    - terminator
#    - guake
#    - wireguard
    - mounts
#    - gnome_config


  # Run tasks specific only to seymour
  tasks:

    - name: Clone repos to home directory.
      git:
        repo: "{{ git_repo_root_ssh }}/{{ item }}"
        dest: "/home/{{ ansible_user }}/{{ item }}"
        accept_hostkey: yes
        key_file: "/home/{{ ansible_user }}/.ssh/id_rsa"
      with_items: "{{ repos }}"
      register: repo_clones
    
    - name: Ensure cloned repos are owned by {{ ansible_user }}{{ ':' }}{{ ansible_user }}
      file:
        recurse: yes
        path: "/home/{{ ansible_user }}/{{ item }}"
        state: directory
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
      with_items: "{{ repos }}"
      when: repo_clones is changed

  vars:
    repos:
      - scripts
      - misc
      - docs